function initDivLabelAnimation(){$("input:text.get.validate, textarea.get.validate").on("focus",function(n){var t=$(n.target).siblings("div .div-as-label-text-editable");t.length>0&&$(t).addClass("theme-main-color")});$("input:text.get.validate, textarea.get.validate").on("blur",function(n){var t=$(n.target).siblings("div .div-as-label-text-editable");t.length>0&&$(t).removeClass("theme-main-color")})}function initInputRecap(){$("input:text.get.validate, textarea.get.validate").on("change keyup",function(n){var t=$(n.target).attr("name"),i=$("[data-recap="+t+"]");isNull(t)||isObjEmpty(i)||i.val(getValCleanBySelector(n.target))})}function initOptionsDependencyAndRecap(){$.each($(" .placeholder-field["+SharedConstFormDynamic.get("AttributeFieldHasOptions")+"]["+SharedConstFormDynamic.get("AttributeFieldHasOptions")+'!=""]['+SharedConstFormDynamic.get("AttributeFieldChoiceType")+"]["+SharedConstFormDynamic.get("AttributeFieldChoiceType")+'!=""]'),function(n,t){var i=$(t)[0].hasAttribute(SharedConstFormDynamic.get("AttributeFieldHasRelated")),r=$(t).attr(SharedConstFormDynamic.get("AttributeFieldChoiceType")),u=$(t).attr(SharedConstFormDynamic.get("AttributeFieldHasOptions")),f=$(t).attr(SharedConstFormDynamic.get("AttributeDependentField"));choiceWithOptionalFieldEventsInit(u,r,i,f)})}function choiceWithOptionalFieldEventsInit(n,t,i,r){if(i)$("[name="+n+SharedConstFormDynamic.get("SuffixOtherField")+"]").on("change keyup",function(){var i="";isWhitespace($("[name="+n+SharedConstFormDynamic.get("SuffixOtherField")+"]").val())||(i=SharedConstFormDynamic.get("OtherFieldAggregatedToSelectedOptionFormattedSeparator")+getValCleanBySelector("[name="+n+SharedConstFormDynamic.get("SuffixOtherField")+"]"));copySelectionToRecap(t,n,i)});$("[name="+n+"]").on("change keyup",function(){i&&($("input[name="+n+"]:last").is(":checked")||$("#"+n+" option:last").is(":selected")?$("[name="+n+SharedConstFormDynamic.get("SuffixOtherField")+"]").attr("required","required"):($("[name="+n+SharedConstFormDynamic.get("SuffixOtherField")+"]").removeAttr("required"),$("[name="+n+SharedConstFormDynamic.get("SuffixOtherField")+"]").removeClass("valid invalid form-error")));isWhitespace(r)||($("input[name="+n+"]:last").is(":checked")||$("#"+n+" option:last").is(":selected")?$("[name="+r+"]").attr("required","required"):($("[name="+r+"]").removeAttr("required"),$("[name="+r+"]").removeClass("valid invalid form-error")));copySelectionToRecap(t,n,"")})}function copySelectionToRecap(n,t,i){var r="",f=!1,e,u,s,o,h;switch(n){case SharedConstFormDynamic.get("OptionsSelect"):u='select[name="'+t+'"]';e=$(u).val();r=cleanStringSafe($(u).children('option[value="'+e+'"]').text());isObjEmpty(e)&&(r="");f=!0;break;case SharedConstFormDynamic.get("OptionsSelectMultiple"):u='select[multiple][name="'+t+'"]';s=$(u).val();f=!0;o=[];$(s).each(function(n,t){o.push(cleanStringSafe($(u).children('option[value="'+t+'"]').text()))});r=o.join(SharedConstFormDynamic.get("OptionsMultipleSelectedDescriptionsFormattedSeparator"));break;case SharedConstFormDynamic.get("OptionsCheckBox"):r=$("input[name="+t+"]:checked").map(function(){return f=!0,cleanStringSafe($(this).siblings("span").text())}).get().join(SharedConstFormDynamic.get("OptionsMultipleSelectedDescriptionsFormattedSeparator"));break;case SharedConstFormDynamic.get("OptionsRadio"):h=$("input[name="+t+"]:checked");h.val()!==SharedConstFormDynamic.get("ValueAttachmentOption")&&(r=cleanStringSafe($("input[name="+t+"]:checked").siblings("span").text()),f=!0);break;default:console.log("table type is unhandled"+n)}f===!0&&$("[data-recap="+t+"]").val(cleanStringSafe(r+i))}function initAttachmentControls(){var n="";$("input[type=radio]["+SharedConstFormDynamic.get("AttributeHasAttachment")+"]").each(function(t,i){n=$(i).attr("name");$('input[type=radio][name="'+n+'"]').on("change keyup",function(n){var r=$(n.target),i=$('input[type=radio][name="'+r.attr("name")+'"]['+SharedConstFormDynamic.get("AttributeHasAttachment")+"]"),t=$(".wrap_checked_poss_doc["+SharedConstFormDynamic.get("AttributeFieldRelatedTo")+'="'+i.attr("id")+'"]');i.is(":checked")===!0?(t.find(".file-path").attr("required",!0),t.show()):(t.find(".file-path").attr("required",!1).attr("aria-required",null).val(null).valid(),t.hide(),t.find("input[type=file]").clearInputs())})});$(document).delegate("input[type=file].attachment.radio-file-option","change",function(n){var t=$("#"+$(n.target).attr(SharedConstFormDynamic.get("AttributeAttachmentPathsFieldName"))),i=$("#"+$(n.target).attr(SharedConstFormDynamic.get("AttributeAttachmentRadioId"))),r=$(n.target).attr(SharedConstFormDynamic.get("AttributeAttachmentFieldName"));i.length>0&&t.length>0&&r.length>0&&i.is(":checked")===!0&&$("[data-recap='"+r+"']").val(cleanStringSafe(t.val()))});$(document).delegate("input[type=file].attachment.attach-basic","change",function(n){var t=$("#"+$(n.target).attr(SharedConstFormDynamic.get("AttributeAttachmentPathsFieldName"))),i=$(n.target).attr(SharedConstFormDynamic.get("AttributeAttachmentFieldName"));t.length>0&&i.length>0&&$("[data-recap='"+i+"']").val(cleanStringSafe(t.val()))})}function initCommonActions(){$("#save-current-step").on("click",function(n){n.preventDefault();submitFormDynamic(SharedVarsFormDynamic.get("ActionSaveWithoutAdvance"),SharedVarsFormDynamic.get("ReValidateBeforePost"))});$("#abort-current-item").on("click",function(n){n.preventDefault();modalConfirm(SharedConstFormDynamic.get("ConfirmItemAbort"),submitFormDynamic,SharedVarsFormDynamic.get("ActionAbort"),!1)});$("#rollback-current-step").on("click",function(n){n.preventDefault();modalConfirm(SharedConstFormDynamic.get("ConfirmStepRollback"),submitFormDynamic,SharedVarsFormDynamic.get("ActionRollback"),!1)});$(".cancella-allegato").each(function(n,t){$(t).on("click",function(){modalConfirm(GetMessageForConfirmDeleteAttachment(t,SharedConstFormDynamic.get("ConfirmAttachmentDeleteMsgWithPlh")),submitFormAttachmentDelete,t)})});$(".link-form-att-del").each(function(n,t){var i="#"+$(t).prop("id");$(i).on("click",function(n){n.preventDefault();var t=GetMessageForConfirmDeleteAttachment(i,SharedConstFormDynamic.get("ConfirmAttachmentDeleteMsgWithPlh"));modalConfirm(t,submitFormMultiStepAttachmentDelete,i)})})}function GetMessageForConfirmDeleteAttachment(n,t){return t.trim().replace(SharedConstFormDynamic.get("PlhDeleteFileName"),$(n).children("div.hidden").text().trim())}function submitFormAttachmentDelete(n){$(n).closest("form").submit()}function submitFormMultiStepAttachmentDelete(n){var i=$(n).attr(SharedConstFormDynamic.get("AttributeIdFormDeleteAttachment")),t=$("#"+i),r,u;if(t.length<=0){console.log("the phantom pain");multipleSubmitDel=!1;return}(r=t.attr("method"),u=t.attr("action"),multipleSubmitDel)||(multipleSubmitDel=!0,showPreloader(),$.ajax({type:r,url:u,data:t.serialize(),success:function(n){hidePreloader();multipleSubmitDel=!1;isNull(n)&&(console.log("server returned an empty data object"),modalAlert("Generic error"));n.hasOwnProperty("message")||(console.log('server returned data object without property "message" '),modalAlert("Generic error"));n.hasOwnProperty("idForDeletedAttachmentLinkRemove")||(console.log('server returned data object without property "idForDeletedAttachmentLinkRemove" '),modalAlert("Generic error"));isNull(n.message)||isWhitespace(n.message)||modalAlert(n.message);$("#"+n.idForDeletedAttachmentLinkRemove).remove();$("#"+i).remove();$(".link-form-att-del").length<=0&&$(".file-path.att-required").attr("required",!0);return},error:function(n,t,i){hidePreloader();multipleSubmitDel=!1;console.log("status: "+n.status+", textStatus: "+t+", errorThrown: "+i);modalAlert("Response Error, contact support");return}}))}function submitFormDynamic(n,t){var r,u,i,f;if(t===!0&&!$("#form-dynamic").valid()){r=$("#form-dynamic .invalid:first-of-type");r.length>0&&$("html,body").animate({scrollTop:r.offset().top-20});multiplesubmit=!1;return}multiplesubmit||(multiplesubmit=!0,showPreloader(),u=buildFormForPost(n,SharedVarsFormDynamic.get("SaveDescription")),i=new XMLHttpRequest,i.onreadystatechange=function(n){if(i.readyState===4&&i.status>299&&(hidePreloader(),modalAlert("Error: "+n.statusText),multiplesubmit=!1),i.readyState===4&&i.status===200){hidePreloader();var t=ajaxJsonResponseSafeParse(n);if(console.log(t),isObjEmpty(t))hidePreloader(),modalAlert("Json error");else switch(t.resultCode){case"KoNoReload":modalAlert(t.errorMessage);break;case"OkToItem":window.location.replace(SharedVarsFormDynamic.get("RedirectToItemUrl"));break;case"OkToMainpage":window.location.replace(SharedVarsFormDynamic.get("RedirectToMainpageUrl"));case"OkWithReload":location.reload();break;case"OkNoReload":$("#anonymous-login-code").text(t.loginCodeForAnonymousInsert);$("#form-dynamic").hide();$("#item-basic-info").hide();$(".stepper").hide();$(".submitted-stepper-form").show();window.scrollTo(0,0);break;default:modalAlert("unrecognized response code")}multiplesubmit=!1;return}},i.open("POST",SharedVarsFormDynamic.get("SubmitUrl")),f=$("#form-dynamic").find('input[name="__RequestVerificationToken"]').val(),u.append("__RequestVerificationToken",f),i.setRequestHeader("__RequestVerificationToken",f),i.send(u))}function buildFormForPost(n,t){var i=new FormData,r;return i.append("azione",n),i.append("fase",$("#fase").val()),i.append("stato",$("#stato").val()),t===!0?$.each($("#form-dynamic").find("[data-recap]"),function(n,t){i.append($(t).attr("data-recap"),getValCleanBySelector(t))}):($("#form-dynamic  input.to-use-for-altern-normal,#form-dynamic textarea.to-use-for-altern-normal,#form-dynamic select.to-use-for-altern-normal:not([multiple])").each(function(n,t){i.append($(t).attr("name"),getValCleanBySelector(t))}),$("#form-dynamic select.to-use-for-altern-normal[multiple]").each(function(n,t){var r="";!isNull($(t))&&!isObjEmpty($(t))&&$(t).val().length>0&&(r=$(t).val().join(SharedConstFormDynamic.get("OptionsMultipleSelectedValuesSeparator")));i.append($(t).attr("name"),r)}),r=[],$("#form-dynamic input.to-use-for-altern-checked").map(function(){return this.name}).each(function(n,t){~$.inArray(t,r)||r.push(t)}),$.each(r,function(n,t){var r,u;$('#form-dynamic input[name="'+t+'"]').is(":checkbox")&&(r=$('#form-dynamic input[name="'+t+'"]:checked').map(function(){return cleanStringSafe($(this).val())}).get().join(SharedConstFormDynamic.get("OptionsMultipleSelectedValuesSeparator")),i.append(t,cleanStringSafe(r)));$('#form-dynamic input[name="'+t+'"]').is(":radio")&&(u=$('#form-dynamic input[name="'+t+'"]:checked').val(),i.append(t,cleanStringSafe(u)))})),$.each($("input[type=file].attachment"),function(n,t){for(var u=$(t).attr(SharedConstFormDynamic.get("AttributeAttachmentPathsFieldName")),r=0;r<t.files.length;r++)i.append(u+r,t.files[r])}),i}var multipleSubmitDel,multiplesubmit;$(function(){$(".submitted-stepper-form").hide();initDivLabelAnimation();initInputRecap();initOptionsDependencyAndRecap();initAttachmentControls();initCommonActions()});multipleSubmitDel=!1;multiplesubmit=!1;